<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools to Easily Download Data from INSEE BDM Database • insee</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools to Easily Download Data from INSEE BDM Database">
<meta property="og:description" content="Using embedded sdmx queries, get the data of more than 140 000 insee series from bdm database. Have a look at the detailed sdmx web service page with the following link : &lt;https://www.insee.fr/en/information/2868055&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">insee</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/insee-vignettes.html">Tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hadrilec/insee/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="insee-r-package" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#insee-r-package" class="anchor"></a>insee R package</h1></div>
<p><br></p>
<p><a href="https://cran.r-project.org/package=insee"><img src="https://www.r-pkg.org/badges/version/insee" alt="CRAN status"></a> <a href="https://cran.r-project.org/web/checks/check_results_insee.html"><img src="https://cranchecks.info/badges/worst/insee" alt="CRAN checks"></a> <a href="https://www.tidyverse.org/lifecycle/#maturing"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="lifecycle"></a> <a href="https://codecov.io/gh/hadrilec/insee?branch=master"><img src="https://codecov.io/gh/hadrilec/insee/branch/master/graph/badge.svg" alt="Codecov test coverage"></a> <a href="https://cran.r-project.org/package=insee"><img src="https://cranlogs.r-pkg.org/badges/grand-total/insee" alt="Downloads"></a> <a href="https://cran.r-project.org/package=insee"><img src="https://cranlogs.r-pkg.org/badges/insee" alt="Downloads"></a> <a href="https://www.repostatus.org/"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></p>
<p><br></p>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The insee package contains tools to easily download data and metadata from INSEE BDM database. Using embedded SDMX queries, get the data of more than 140 000 INSEE series from BDM database (Banque de données macroéconomiques).</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># Get the development version from GitHub</span>
<span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("hadrilec/insee")</span>

<span class="co"># Get the CRAN version</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"insee"</span>)</pre></div>
</div>
</div>
<div id="library" class="section level1">
<h1 class="hasAnchor">
<a href="#library" class="anchor"></a>Library</h1>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co"># examples below use tidyverse packages </span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">insee</span>)</pre></div>
</div>
<div id="get-insee-datasets-list" class="section level1">
<h1 class="hasAnchor">
<a href="#get-insee-datasets-list" class="anchor"></a>get INSEE datasets list</h1>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">dataset</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_dataset_list.html">get_dataset_list</a></span>()</pre></div>
</div>
<div id="get-insee-series-key-idbank-list" class="section level1">
<h1 class="hasAnchor">
<a href="#get-insee-series-key-idbank-list" class="anchor"></a>get INSEE series key (idbank) list</h1>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">idbank_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_idbank_list.html">get_idbank_list</a></span>()</pre></div>
</div>
<div id="select-idbanks" class="section level1">
<h1 class="hasAnchor">
<a href="#select-idbanks" class="anchor"></a>select idbanks</h1>
<div class="sourceCode" id="cb5"><pre class="r"><span class="no">idbank_list_selected</span> <span class="kw">=</span>
  <span class="no">idbank_list</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">nomflow</span> <span class="kw">==</span> <span class="st">"ENQ-CONJ-ACT-IND"</span>) <span class="kw">%&gt;%</span> <span class="co">#industry activity survey </span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim4</span> <span class="kw">==</span> <span class="st">"A88-29"</span>) <span class="kw">%&gt;%</span> <span class="co"># 29 : automotive industry, A88 : aggregation level - 88 sectors</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim8</span>  <span class="kw">==</span> <span class="st">"CVS"</span>) <span class="kw">%&gt;%</span> <span class="co">#seasonally adjusted</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim5</span> <span class="kw">==</span> <span class="st">"SOLDE_PROPORTION"</span>) <span class="kw">%&gt;%</span> <span class="co">#balance of opinion</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim2</span> <span class="kw">==</span> <span class="st">"ECAI_TPE"</span>)  <span class="co">#expected trend in employment</span></pre></div>
</div>
<div id="get-idbank-title" class="section level1">
<h1 class="hasAnchor">
<a href="#get-idbank-title" class="anchor"></a>get idbank title</h1>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">idbank_list_selected</span> <span class="kw">=</span>
  <span class="no">idbank_list_selected</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_title.html">get_insee_title</a></span>(<span class="no">idbank</span>, <span class="kw">lang</span> <span class="kw">=</span> <span class="st">"en"</span>))</pre></div>
</div>
<div id="extract-selected-idbanks-list" class="section level1">
<h1 class="hasAnchor">
<a href="#extract-selected-idbanks-list" class="anchor"></a>extract selected idbanks list</h1>
<div class="sourceCode" id="cb7"><pre class="r"><span class="no">list_idbank</span> <span class="kw">=</span> <span class="no">idbank_list_selected</span> <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">idbank</span>)</pre></div>
</div>
<div id="get-selected-idbanks-data" class="section level1">
<h1 class="hasAnchor">
<a href="#get-selected-idbanks-data" class="anchor"></a>get selected idbanks data</h1>
<div class="sourceCode" id="cb8"><pre class="r"><span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_idbank.html">get_insee_idbank</a></span>(<span class="no">list_idbank</span>)</pre></div>
</div>
<div id="avoid-proxy-issues" class="section level1">
<h1 class="hasAnchor">
<a href="#avoid-proxy-issues" class="anchor"></a>avoid proxy issues</h1>
<div class="sourceCode" id="cb9"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span>(<span class="kw">http_proxy</span> <span class="kw">=</span> <span class="st">"my_proxy_server"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span>(<span class="kw">https_proxy</span> <span class="kw">=</span> <span class="st">"my_proxy_server"</span>)</pre></div>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<div id="gdp-growth-rate" class="section level2">
<h2 class="hasAnchor">
<a href="#gdp-growth-rate" class="anchor"></a>GDP growth rate</h2>
<div class="sourceCode" id="cb10"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)

<span class="no">idbank_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_idbank_list.html">get_idbank_list</a></span>()

<span class="no">df_idbank_list_selected</span> <span class="kw">=</span>
  <span class="no">idbank_list</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">nomflow</span> <span class="kw">==</span> <span class="st">"CNT-2014-PIB-EQB-RF"</span>) <span class="kw">%&gt;%</span> <span class="co"># Gross domestic product balance</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim1</span> <span class="kw">==</span> <span class="st">"T"</span>) <span class="kw">%&gt;%</span> <span class="co">#quarter</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim4</span> <span class="kw">==</span> <span class="st">"PIB"</span>) <span class="kw">%&gt;%</span> <span class="co">#GDP</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim6</span> <span class="kw">==</span> <span class="st">"TAUX"</span>) <span class="kw">%&gt;%</span> <span class="co">#rate</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim10</span> <span class="kw">==</span> <span class="st">"CVS-CJO"</span>) <span class="co">#SA-WDA, seasonally adjusted, working day adjusted</span>

<span class="no">idbank</span> <span class="kw">=</span> <span class="no">df_idbank_list_selected</span> <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">idbank</span>)

<span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_idbank.html">get_insee_idbank</a></span>(<span class="no">idbank</span>)

<span class="co">#plot</span>
<span class="fu">ggplot</span>(<span class="no">data</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">DATE</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">OBS_VALUE</span>)) +
  <span class="fu">geom_col</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"French GDP growth rate, quarter-on-quarter, sa-wda"</span>) +
  <span class="fu">labs</span>(<span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Last updated : %s"</span>, <span class="no">data</span>$<span class="no">TIME_PERIOD</span>[<span class="fl">1</span>]))</pre></div>
<p><img src="articles/gdp.png"></p>
</div>
<div id="inflation" class="section level2">
<h2 class="hasAnchor">
<a href="#inflation" class="anchor"></a>Inflation</h2>
<div class="sourceCode" id="cb11"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)

<span class="no">idbank_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_idbank_list.html">get_idbank_list</a></span>()

<span class="no">df_idbank_list_selected</span> <span class="kw">=</span>
  <span class="no">idbank_list</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">nomflow</span> <span class="kw">==</span> <span class="st">"IPC-2015"</span>) <span class="kw">%&gt;%</span> <span class="co">#Inflation dataset</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim1</span> <span class="kw">==</span> <span class="st">"M"</span>) <span class="kw">%&gt;%</span> <span class="co"># monthly</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">str_detect</span>(<span class="no">dim4</span>, <span class="st">"^[0-9]{2}$"</span>)) <span class="kw">%&gt;%</span> <span class="co"># coicop aggregation level</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim6</span> <span class="kw">==</span> <span class="st">"INDICE"</span>) <span class="kw">%&gt;%</span> <span class="co"># index</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim7</span> <span class="kw">==</span> <span class="st">"ENSEMBLE"</span>) <span class="kw">%&gt;%</span> <span class="co"># all kinds of household</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim8</span> <span class="kw">==</span> <span class="st">"FE"</span>) <span class="kw">%&gt;%</span> <span class="co"># all France including overseas departements</span>
  <span class="fu">mutate</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_title.html">get_insee_title</a></span>(<span class="no">idbank</span>))

<span class="no">list_idbank</span> <span class="kw">=</span> <span class="no">df_idbank_list_selected</span> <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">idbank</span>)

<span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_idbank.html">get_insee_idbank</a></span>(<span class="no">list_idbank</span>, <span class="kw">startPeriod</span> <span class="kw">=</span> <span class="st">"2015-01"</span>)

<span class="no">n_sep</span> <span class="kw">=</span> <span class="fu">str_count</span>(<span class="no">data</span>$<span class="no">TITLE_FR</span>[<span class="fl">1</span>], <span class="st">" - "</span>) + <span class="fl">1</span>

<span class="no">data_plot</span> <span class="kw">=</span> <span class="no">data</span> <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">TITLE_EN</span>, <span class="kw">into</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"title"</span>, <span class="fl">1</span>:<span class="no">n_sep</span>),
           <span class="kw">sep</span> <span class="kw">=</span> <span class="st">" - "</span>, <span class="kw">remove</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"right"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">title6</span> <span class="kw">=</span> <span class="fu">case_when</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">title6</span>) ~ <span class="no">title5</span>,
                            <span class="fl">TRUE</span> ~ <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">title6</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">title6</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="no">title6</span>, <span class="fl">1</span> , <span class="fl">22</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">month</span> <span class="kw">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span>(<span class="no">DATE</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">DATE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">title6</span>, <span class="no">month</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">growth</span> <span class="kw">=</span> <span class="fl">100</span> * (<span class="no">OBS_VALUE</span> / <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span>(<span class="no">OBS_VALUE</span>) - <span class="fl">1</span>))

<span class="fu">ggplot</span>(<span class="no">data_plot</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">DATE</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">growth</span>)) +
  <span class="fu">geom_col</span>() +
  <span class="fu">facet_wrap</span>(~<span class="no">title6</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free"</span>) +
  <span class="fu">ggtitle</span>(<span class="st">"French inflation, by product categories, year-on-year"</span>) +
  <span class="fu">labs</span>(<span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Last updated : %s"</span>, <span class="no">data_plot</span>$<span class="no">TIME_PERIOD</span>[<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">data_plot</span>)]))</pre></div>
<p><img src="articles/inflation.png"></p>
</div>
<div id="unemployment-rate" class="section level2">
<h2 class="hasAnchor">
<a href="#unemployment-rate" class="anchor"></a>Unemployment rate</h2>
<div class="sourceCode" id="cb12"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)

<span class="no">dataset_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_dataset_list.html">get_dataset_list</a></span>()

<span class="no">idbank_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_idbank_list.html">get_idbank_list</a></span>()

<span class="no">df_idbank_list_selected</span> <span class="kw">=</span>
  <span class="no">idbank_list</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">nomflow</span> <span class="kw">==</span> <span class="st">"CHOMAGE-TRIM-NATIONAL"</span>) <span class="kw">%&gt;%</span> <span class="co">#Unemployment dataset</span>
  <span class="fu">mutate</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_title.html">get_insee_title</a></span>(<span class="no">idbank</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim2</span> <span class="kw">==</span> <span class="st">"CTTXC"</span>) <span class="kw">%&gt;%</span> <span class="co">#unemployment rate based on ILO standards</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim4</span> <span class="kw">==</span> <span class="st">"FE"</span>) <span class="kw">%&gt;%</span>  <span class="co"># all France including overseas departements</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim5</span> <span class="kw">==</span> <span class="fl">0</span>) <span class="co"># men and women</span>

<span class="no">list_idbank</span> <span class="kw">=</span> <span class="no">df_idbank_list_selected</span> <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">idbank</span>)

<span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_idbank.html">get_insee_idbank</a></span>(<span class="no">list_idbank</span>, <span class="kw">startPeriod</span> <span class="kw">=</span> <span class="st">"2000-01"</span>)

<span class="no">n_sep</span> <span class="kw">=</span> <span class="fu">str_count</span>(<span class="no">data</span>$<span class="no">TITLE_FR</span>[<span class="fl">1</span>], <span class="st">" - "</span>) + <span class="fl">1</span>

<span class="no">data_plot</span> <span class="kw">=</span> <span class="no">data</span> <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">TITLE_EN</span>, <span class="kw">into</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"title"</span>, <span class="fl">1</span>:<span class="no">n_sep</span>),
           <span class="kw">sep</span> <span class="kw">=</span> <span class="st">" - "</span>, <span class="kw">remove</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"right"</span>)

<span class="fu">ggplot</span>(<span class="no">data_plot</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">DATE</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">OBS_VALUE</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">title2</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu">geom_point</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"French unemployment rate, by age"</span>) +
  <span class="fu">labs</span>(<span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Last updated : %s"</span>, <span class="no">data_plot</span>$<span class="no">TIME_PERIOD</span>[<span class="fl">1</span>]))</pre></div>
<p><img src="articles/unem.png"></p>
</div>
<div id="population" class="section level2">
<h2 class="hasAnchor">
<a href="#population" class="anchor"></a>Population</h2>
<div id="population-by-age" class="section level3">
<h3 class="hasAnchor">
<a href="#population-by-age" class="anchor"></a>Population by age</h3>
<div class="sourceCode" id="cb13"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)

<span class="no">dataset_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_dataset_list.html">get_dataset_list</a></span>()

<span class="no">idbank_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_idbank_list.html">get_idbank_list</a></span>()

<span class="no">df_idbank_list_selected</span> <span class="kw">=</span>
  <span class="no">idbank_list</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">nomflow</span> <span class="kw">==</span> <span class="st">"POPULATION-STRUCTURE"</span>) <span class="kw">%&gt;%</span> <span class="co">#population dataset</span>
  <span class="fu">mutate</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_title.html">get_insee_title</a></span>(<span class="no">idbank</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim2</span> <span class="kw">==</span> <span class="st">"POPULATION_1ER_JANVIER"</span>) <span class="kw">%&gt;%</span> <span class="co">#population at the beginning of the year</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim5</span> <span class="kw">==</span> <span class="st">"FE"</span>) <span class="kw">%&gt;%</span>  <span class="co"># all France including overseas departements</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim6</span> <span class="kw">==</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>  <span class="co"># men and women</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim7</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"00-19"</span>, <span class="st">"20-59"</span>, <span class="st">"60-"</span>)) <span class="co">#age ranges</span>

<span class="no">list_idbank</span> <span class="kw">=</span> <span class="no">df_idbank_list_selected</span> <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">idbank</span>)

<span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_idbank.html">get_insee_idbank</a></span>(<span class="no">list_idbank</span>)

<span class="no">n_sep</span> <span class="kw">=</span> <span class="fu">str_count</span>(<span class="no">data</span>$<span class="no">TITLE_FR</span>[<span class="fl">1</span>], <span class="st">" - "</span>) + <span class="fl">1</span>

<span class="no">data_plot</span> <span class="kw">=</span> <span class="no">data</span> <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">TITLE_EN</span>, <span class="kw">into</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"title"</span>, <span class="fl">1</span>:<span class="no">n_sep</span>),
           <span class="kw">sep</span> <span class="kw">=</span> <span class="st">" - "</span>, <span class="kw">remove</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"right"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">OBS_VALUE</span> <span class="kw">=</span> <span class="no">OBS_VALUE</span> / <span class="fl">10</span>^<span class="fl">6</span>)

<span class="fu">ggplot</span>(<span class="no">data_plot</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">DATE</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">OBS_VALUE</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">title3</span>)) +
  <span class="fu">geom_area</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"French population in millions, by age"</span>) +
  <span class="fu">labs</span>(<span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Last updated : %s"</span>, <span class="no">data_plot</span>$<span class="no">TIME_PERIOD</span>[<span class="fl">1</span>]))</pre></div>
<p><img src="articles/pop.png"></p>
</div>
<div id="population-by-departement" class="section level3">
<h3 class="hasAnchor">
<a href="#population-by-departement" class="anchor"></a>Population by departement</h3>
<div class="sourceCode" id="cb14"><pre class="r">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">insee</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rgdal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">viridis</span>)

<span class="no">idbank_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_idbank_list.html">get_idbank_list</a></span>()

<span class="no">dataset_list</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_dataset_list.html">get_dataset_list</a></span>()

<span class="no">list_idbank</span> <span class="kw">=</span> <span class="no">idbank_list</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">nomflow</span> <span class="kw">==</span> <span class="st">"TCRED-ESTIMATIONS-POPULATION"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim6</span> <span class="kw">==</span> <span class="st">"00-"</span>) <span class="kw">%&gt;%</span> <span class="co">#all ages</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dim5</span> <span class="kw">==</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span> <span class="co">#men and women</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">str_detect</span>(<span class="no">dim4</span>, <span class="st">"^D"</span>)) <span class="kw">%&gt;%</span> <span class="co">#select only departements</span>
  <span class="fu">mutate</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_title.html">get_insee_title</a></span>(<span class="no">idbank</span>))

<span class="no">list_idbank_selected</span> <span class="kw">=</span> <span class="no">list_idbank</span> <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">idbank</span>)

<span class="co"># get population data by departement</span>
<span class="no">pop</span> <span class="kw">=</span> <span class="fu"><a href="reference/get_insee_idbank.html">get_insee_idbank</a></span>(<span class="no">list_idbank_selected</span>)

<span class="co">#get departements' geographical limits</span>
<span class="no">FranceMap</span> <span class="kw">&lt;-</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu">getData</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"GADM"</span>, <span class="kw">country</span> <span class="kw">=</span> <span class="st">"FRA"</span>, <span class="kw">level</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># extract the population by departement in 2020</span>
<span class="no">pop_plot</span> <span class="kw">=</span> <span class="no">pop</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">TITLE_EN</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">DATE</span> <span class="kw">==</span> <span class="st">"2020-01-01"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">dptm</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"D"</span>, <span class="st">""</span>, <span class="no">REF_AREA</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">dptm</span> <span class="kw">%in%</span> <span class="no">FranceMap</span>@<span class="kw">data</span>$<span class="no">CC_2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">dptm</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">dptm</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="no">FranceMap</span>@<span class="kw">data</span>$<span class="no">CC_2</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">dptm</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">id</span> <span class="kw">=</span> <span class="no">dptm</span>)

<span class="no">vec_pop</span> <span class="kw">=</span> <span class="no">pop_plot</span> <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">OBS_VALUE</span>)

<span class="co"># add population data to the departement object map</span>
<span class="no">FranceMap</span>@<span class="kw">data</span>$<span class="no">pop</span> <span class="kw">=</span> <span class="no">vec_pop</span>

<span class="co"># extract the departements' limits from the spatial object</span>
<span class="no">FranceMap_tidy</span> <span class="kw">&lt;-</span> <span class="kw pkg">broom</span><span class="kw ns">::</span><span class="fu"><a href="https://broom.tidymodels.org/reference/reexports.html">tidy</a></span>(<span class="no">FranceMap</span>)

<span class="co"># mapping table</span>
<span class="no">dptm_df</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">dptm</span> <span class="kw">=</span> <span class="no">FranceMap</span>@<span class="kw">data</span>$<span class="no">CC_2</span>,
                     <span class="kw">dptm_name</span> <span class="kw">=</span> <span class="no">FranceMap</span>@<span class="kw">data</span>$<span class="no">NAME_2</span>,
                     <span class="kw">pop</span> <span class="kw">=</span> <span class="no">FranceMap</span>@<span class="kw">data</span>$<span class="no">pop</span>,
                     <span class="kw">id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">FranceMap</span>@<span class="kw">data</span>))

<span class="co"># add population data to departement dataframe</span>
<span class="no">FranceMap_tidy_final</span> <span class="kw">=</span>
  <span class="no">FranceMap_tidy</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">dptm_df</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"id"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">long</span>, <span class="no">lat</span>, <span class="no">pop</span>, <span class="no">group</span>, <span class="no">id</span>)

<span class="fu">ggplot</span>() +
  <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">FranceMap_tidy_final</span>,
               <span class="fu">aes</span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">pop</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>) ,
               <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.9</span>) +
  <span class="fu">coord_map</span>() +
  <span class="fu">theme_void</span>() +
  <span class="fu">scale_fill_viridis</span>() +
  <span class="fu">ggtitle</span>(<span class="st">"Distribution of the population within French territory in 2020"</span>)</pre></div>
<p><img src="articles/pop_map.png"></p>
</div>
</div>
</div>
<div id="support" class="section level1">
<h1 class="hasAnchor">
<a href="#support" class="anchor"></a>Support</h1>
<p>Feel free to contact me with any question about this package using this <a href="mailto:leclerc.hadrien@gmail.com?subject=%5Br-package%5D%5Binsee%5D">e-mail address</a>.</p>
</div>
<div id="disclaimer" class="section level1">
<h1 class="hasAnchor">
<a href="#disclaimer" class="anchor"></a>Disclaimer</h1>
<p>This package is in no way officially related to or endorsed by INSEE.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=insee">https://​cloud.r-project.org/​package=insee</a>
</li>
<li>Browse source code at <br><a href="https://github.com/hadrilec/insee/">https://​github.com/​hadrilec/​insee/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/hadrilec/insee/issues">https://​github.com/​hadrilec/​insee/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Hadrien Leclerc <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Hadrien Leclerc.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
